const nodemailer = require('nodemailer');

class EmailToSmsService {
    constructor() {
        // Initialize nodemailer transporter
        this.transporter = nodemailer.createTransport({
            host: process.env.SMTP_HOST,
            port: process.env.SMTP_PORT,
            secure: process.env.SMTP_SECURE === 'true',
            auth: {
                user: process.env.SMTP_USER,
                pass: process.env.SMTP_PASS
            }
        });

        // Carrier email-to-SMS gateways
        this.carrierGateways = {
            'airtel': '@airtelmail.com',
            'bsnl': '@bsnl.in',
            'idea': '@ideacellular.net',
            'jio': '@jio.com',
            'vodafone': '@vodafone-sms.com',
            'tata': '@tatadocomo.com',
            'reliance': '@rcom.co.in',
            'mtnl': '@mtnl.net.in',
            'vi': '@vtext.com',
            'aircel': '@aircel.co.in',
            'uninor': '@uninor.in',
            'mts': '@mtsindia.in',
            'loop': '@loopmobile.in',
            'docomo': '@docomo.co.in'
        };
    }

    /**
     * Get carrier gateway for a phone number
     * @param {string} phoneNumber - Phone number in format +91 XXXXX XXXXX
     * @returns {string|null} - Carrier gateway email or null if not found
     */
    getCarrierGateway(phoneNumber) {
        // Extract the first 4 digits after +91
        const prefix = phoneNumber.replace(/\+91\s/, '').substring(0, 4);
        
        // Map prefixes to carriers
        const prefixMap = {
            '7000': 'airtel',
            '8000': 'bsnl',
            '9000': 'idea',
            '6000': 'jio',
            '5000': 'vodafone',
            '4000': 'tata',
            '3000': 'reliance',
            '2000': 'mtnl',
            '7002': 'jio',
            '7001': 'vi',
            '7003': 'airtel',
            '7004': 'idea',
            '7005': 'aircel',
            '7006': 'uninor',
            '7007': 'mts',
            '7008': 'loop',
            '7009': 'docomo',
            '7010': 'airtel',
            '7011': 'vi',
            '7012': 'jio',
            '7013': 'idea',
            '7014': 'aircel',
            '7015': 'uninor',
            '7016': 'mts',
            '7017': 'loop',
            '7018': 'docomo',
            '7019': 'airtel',
            '7020': 'vi',
            '7021': 'jio',
            '7022': 'idea',
            '7023': 'aircel',
            '7024': 'uninor',
            '7025': 'mts',
            '7026': 'loop',
            '7027': 'docomo',
            '7028': 'airtel',
            '7029': 'vi',
            '7030': 'jio',
            '7031': 'idea',
            '7032': 'aircel',
            '7033': 'uninor',
            '7034': 'mts',
            '7035': 'loop',
            '7036': 'docomo',
            '7037': 'airtel',
            '7038': 'vi',
            '7039': 'jio',
            '7040': 'idea',
            '7041': 'aircel',
            '7042': 'uninor',
            '7043': 'mts',
            '7044': 'loop',
            '7045': 'docomo',
            '7046': 'airtel',
            '7047': 'vi',
            '7048': 'jio',
            '7049': 'idea',
            '7050': 'aircel',
            '7051': 'uninor',
            '7052': 'mts',
            '7053': 'loop',
            '7054': 'docomo',
            '7055': 'airtel',
            '7056': 'vi',
            '7057': 'jio',
            '7058': 'idea',
            '7059': 'aircel',
            '7060': 'uninor',
            '7061': 'mts',
            '7062': 'loop',
            '7063': 'docomo',
            '7064': 'airtel',
            '7065': 'vi',
            '7066': 'jio',
            '7067': 'idea',
            '7068': 'aircel',
            '7069': 'uninor',
            '7070': 'mts',
            '7071': 'loop',
            '7072': 'docomo',
            '7073': 'airtel',
            '7074': 'vi',
            '7075': 'jio',
            '7076': 'idea',
            '7077': 'aircel',
            '7078': 'uninor',
            '7079': 'mts',
            '7080': 'loop',
            '7081': 'docomo',
            '7082': 'airtel',
            '7083': 'vi',
            '7084': 'jio',
            '7085': 'idea',
            '7086': 'aircel',
            '7087': 'uninor',
            '7088': 'mts',
            '7089': 'loop',
            '7090': 'docomo',
            '7091': 'airtel',
            '7092': 'vi',
            '7093': 'jio',
            '7094': 'idea',
            '7095': 'aircel',
            '7096': 'uninor',
            '7097': 'mts',
            '7098': 'loop',
            '7099': 'docomo',
            // Adding 9xxx series prefixes
            '9000': 'airtel',
            '9001': 'airtel',
            '9002': 'airtel',
            '9003': 'airtel',
            '9004': 'airtel',
            '9005': 'airtel',
            '9006': 'airtel',
            '9007': 'airtel',
            '9008': 'airtel',
            '9009': 'airtel',
            '9010': 'airtel',
            '9011': 'airtel',
            '9012': 'airtel',
            '9013': 'airtel',
            '9014': 'airtel',
            '9015': 'airtel',
            '9016': 'airtel',
            '9017': 'airtel',
            '9018': 'airtel',
            '9019': 'airtel',
            '9020': 'airtel',
            '9021': 'airtel',
            '9022': 'airtel',
            '9023': 'airtel',
            '9024': 'airtel',
            '9025': 'airtel',
            '9026': 'airtel',
            '9027': 'airtel',
            '9028': 'airtel',
            '9029': 'airtel',
            '9030': 'airtel',
            '9031': 'airtel',
            '9032': 'airtel',
            '9033': 'airtel',
            '9034': 'airtel',
            '9035': 'airtel',
            '9036': 'airtel',
            '9037': 'airtel',
            '9038': 'airtel',
            '9039': 'airtel',
            '9040': 'airtel',
            '9041': 'airtel',
            '9042': 'airtel',
            '9043': 'airtel',
            '9044': 'airtel',
            '9045': 'airtel',
            '9046': 'airtel',
            '9047': 'airtel',
            '9048': 'airtel',
            '9049': 'airtel',
            '9050': 'airtel',
            '9051': 'airtel',
            '9052': 'airtel',
            '9053': 'airtel',
            '9054': 'airtel',
            '9055': 'airtel',
            '9056': 'airtel',
            '9057': 'airtel',
            '9058': 'airtel',
            '9059': 'airtel',
            '9060': 'airtel',
            '9061': 'airtel',
            '9062': 'airtel',
            '9063': 'airtel',
            '9064': 'airtel',
            '9065': 'airtel',
            '9066': 'airtel',
            '9067': 'airtel',
            '9068': 'airtel',
            '9069': 'airtel',
            '9070': 'airtel',
            '9071': 'airtel',
            '9072': 'airtel',
            '9073': 'airtel',
            '9074': 'airtel',
            '9075': 'airtel',
            '9076': 'airtel',
            '9077': 'airtel',
            '9078': 'airtel',
            '9079': 'airtel',
            '9080': 'airtel',
            '9081': 'airtel',
            '9082': 'airtel',
            '9083': 'airtel',
            '9084': 'airtel',
            '9085': 'airtel',
            '9086': 'airtel',
            '9087': 'airtel',
            '9088': 'airtel',
            '9089': 'airtel',
            '9090': 'airtel',
            '9091': 'airtel',
            '9092': 'airtel',
            '9093': 'airtel',
            '9094': 'airtel',
            '9095': 'airtel',
            '9096': 'airtel',
            '9097': 'airtel',
            '9098': 'airtel',
            '9099': 'airtel',
            '9100': 'airtel',
            '9101': 'airtel',
            '9102': 'airtel',
            '9103': 'airtel',
            '9104': 'airtel',
            '9105': 'airtel',
            '9106': 'airtel',
            '9107': 'airtel',
            '9108': 'airtel',
            '9109': 'airtel',
            '9110': 'airtel',
            '9111': 'airtel',
            '9112': 'airtel',
            '9113': 'airtel',
            '9114': 'airtel',
            '9115': 'airtel',
            '9116': 'airtel',
            '9117': 'airtel',
            '9118': 'airtel',
            '9119': 'airtel',
            '9120': 'airtel',
            '9121': 'airtel',
            '9122': 'airtel',
            '9123': 'airtel',
            '9124': 'airtel',
            '9125': 'airtel',
            '9126': 'airtel',
            '9127': 'airtel',
            '9128': 'airtel',
            '9129': 'airtel',
            '9130': 'airtel',
            '9131': 'airtel',
            '9132': 'airtel',
            '9133': 'airtel',
            '9134': 'airtel',
            '9135': 'airtel',
            '9136': 'airtel',
            '9137': 'airtel',
            '9138': 'airtel',
            '9139': 'airtel',
            '9140': 'airtel',
            '9141': 'airtel',
            '9142': 'airtel',
            '9143': 'airtel',
            '9144': 'airtel',
            '9145': 'airtel',
            '9146': 'airtel',
            '9147': 'airtel',
            '9148': 'airtel',
            '9149': 'airtel',
            '9150': 'airtel',
            '9151': 'airtel',
            '9152': 'airtel',
            '9153': 'airtel',
            '9154': 'airtel',
            '9155': 'airtel',
            '9156': 'airtel',
            '9157': 'airtel',
            '9158': 'airtel',
            '9159': 'airtel',
            '9160': 'airtel',
            '9161': 'airtel',
            '9162': 'airtel',
            '9163': 'airtel',
            '9164': 'airtel',
            '9165': 'airtel',
            '9166': 'airtel',
            '9167': 'airtel',
            '9168': 'airtel',
            '9169': 'airtel',
            '9170': 'airtel',
            '9171': 'airtel',
            '9172': 'airtel',
            '9173': 'airtel',
            '9174': 'airtel',
            '9175': 'airtel',
            '9176': 'airtel',
            '9177': 'airtel',
            '9178': 'airtel',
            '9179': 'airtel',
            '9180': 'airtel',
            '9181': 'airtel',
            '9182': 'airtel',
            '9183': 'airtel',
            '9184': 'airtel',
            '9185': 'airtel',
            '9186': 'airtel',
            '9187': 'airtel',
            '9188': 'airtel',
            '9189': 'airtel',
            '9190': 'airtel',
            '9191': 'airtel',
            '9192': 'airtel',
            '9193': 'airtel',
            '9194': 'airtel',
            '9195': 'airtel',
            '9196': 'airtel',
            '9197': 'airtel',
            '9198': 'airtel',
            '9199': 'airtel',
            '9300': 'airtel',
            '9301': 'airtel',
            '9302': 'airtel',
            '9303': 'airtel',
            '9304': 'airtel',
            '9305': 'airtel',
            '9306': 'airtel',
            '9307': 'airtel',
            '9308': 'airtel',
            '9309': 'airtel',
            '9310': 'airtel',
            '9311': 'airtel',
            '9312': 'airtel',
            '9313': 'airtel',
            '9314': 'airtel',
            '9315': 'airtel',
            '9316': 'airtel',
            '9317': 'airtel',
            '9318': 'airtel',
            '9319': 'airtel',
            '9320': 'airtel',
            '9321': 'airtel',
            '9322': 'airtel',
            '9323': 'airtel',
            '9324': 'airtel',
            '9325': 'airtel',
            '9326': 'airtel',
            '9327': 'airtel',
            '9328': 'airtel',
            '9329': 'airtel',
            '9330': 'airtel',
            '9331': 'airtel',
            '9332': 'airtel',
            '9333': 'airtel',
            '9334': 'airtel',
            '9335': 'airtel',
            '9336': 'airtel',
            '9337': 'airtel',
            '9338': 'airtel',
            '9339': 'airtel',
            '9340': 'airtel',
            '9341': 'airtel',
            '9342': 'airtel',
            '9343': 'airtel',
            '9344': 'airtel',
            '9345': 'airtel',
            '9346': 'airtel',
            '9347': 'airtel',
            '9348': 'airtel',
            '9349': 'airtel',
            '9350': 'airtel',
            '9351': 'airtel',
            '9352': 'airtel',
            '9353': 'airtel',
            '9354': 'airtel',
            '9355': 'airtel',
            '9356': 'airtel',
            '9357': 'airtel',
            '9358': 'airtel',
            '9359': 'airtel',
            '9360': 'airtel',
            '9361': 'airtel',
            '9362': 'airtel',
            '9363': 'airtel',
            '9364': 'airtel',
            '9365': 'airtel',
            '9366': 'airtel',
            '9367': 'airtel',
            '9368': 'airtel',
            '9369': 'airtel',
            '9370': 'airtel',
            '9371': 'airtel',
            '9372': 'airtel',
            '9373': 'airtel',
            '9374': 'airtel',
            '9375': 'airtel',
            '9376': 'airtel',
            '9377': 'airtel',
            '9378': 'airtel',
            '9379': 'airtel',
            '9380': 'airtel',
            '9381': 'airtel',
            '9382': 'airtel',
            '9383': 'airtel',
            '9384': 'airtel',
            '9385': 'airtel',
            '9386': 'airtel',
            '9387': 'airtel',
            '9388': 'airtel',
            '9389': 'airtel',
            '9390': 'airtel',
            '9391': 'airtel',
            '9392': 'airtel',
            '9393': 'airtel',
            '9394': 'airtel',
            '9395': 'airtel',
            '9396': 'airtel',
            '9397': 'airtel',
            '9398': 'airtel',
            '9399': 'airtel',
            '9400': 'airtel',
            '9401': 'airtel',
            '9402': 'airtel',
            '9403': 'airtel',
            '9404': 'airtel',
            '9405': 'airtel',
            '9406': 'airtel',
            '9407': 'airtel',
            '9408': 'airtel',
            '9409': 'airtel',
            '9410': 'airtel',
            '9411': 'airtel',
            '9412': 'airtel',
            '9413': 'airtel',
            '9414': 'airtel',
            '9415': 'airtel',
            '9416': 'airtel',
            '9417': 'airtel',
            '9418': 'airtel',
            '9419': 'airtel',
            '9420': 'airtel',
            '9421': 'airtel',
            '9422': 'airtel',
            '9423': 'airtel',
            '9424': 'airtel',
            '9425': 'airtel',
            '9426': 'airtel',
            '9427': 'airtel',
            '9428': 'airtel',
            '9429': 'airtel',
            '9430': 'airtel',
            '9431': 'airtel',
            '9432': 'airtel',
            '9433': 'airtel',
            '9434': 'airtel',
            '9435': 'airtel',
            '9436': 'airtel',
            '9437': 'airtel',
            '9438': 'airtel',
            '9439': 'airtel',
            '9440': 'airtel',
            '9441': 'airtel',
            '9442': 'airtel',
            '9443': 'airtel',
            '9444': 'airtel',
            '9445': 'airtel',
            '9446': 'airtel',
            '9447': 'airtel',
            '9448': 'airtel',
            '9449': 'airtel',
            '9450': 'airtel',
            '9451': 'airtel',
            '9452': 'airtel',
            '9453': 'airtel',
            '9454': 'airtel',
            '9455': 'airtel',
            '9456': 'airtel',
            '9457': 'airtel',
            '9458': 'airtel',
            '9459': 'airtel',
            '9460': 'airtel',
            '9461': 'airtel',
            '9462': 'airtel',
            '9463': 'airtel',
            '9464': 'airtel',
            '9465': 'airtel',
            '9466': 'airtel',
            '9467': 'airtel',
            '9468': 'airtel',
            '9469': 'airtel',
            '9470': 'airtel',
            '9471': 'airtel',
            '9472': 'airtel',
            '9473': 'airtel',
            '9474': 'airtel',
            '9475': 'airtel',
            '9476': 'airtel',
            '9477': 'airtel',
            '9478': 'airtel',
            '9479': 'airtel',
            '9480': 'airtel',
            '9481': 'airtel',
            '9482': 'airtel',
            '9483': 'airtel',
            '9484': 'airtel',
            '9485': 'airtel',
            '9486': 'airtel',
            '9487': 'airtel',
            '9488': 'airtel',
            '9489': 'airtel',
            '9490': 'airtel',
            '9491': 'airtel',
            '9492': 'airtel',
            '9493': 'airtel',
            '9494': 'airtel',
            '9495': 'airtel',
            '9496': 'airtel',
            '9497': 'airtel',
            '9498': 'airtel',
            '9499': 'airtel',
            '9500': 'airtel',
            '9501': 'airtel',
            '9502': 'airtel',
            '9503': 'airtel',
            '9504': 'airtel',
            '9505': 'airtel',
            '9506': 'airtel',
            '9507': 'airtel',
            '9508': 'airtel',
            '9509': 'airtel',
            '9510': 'airtel',
            '9511': 'airtel',
            '9512': 'airtel',
            '9513': 'airtel',
            '9514': 'airtel',
            '9515': 'airtel',
            '9516': 'airtel',
            '9517': 'airtel',
            '9518': 'airtel',
            '9519': 'airtel',
            '9520': 'airtel',
            '9521': 'airtel',
            '9522': 'airtel',
            '9523': 'airtel',
            '9524': 'airtel',
            '9525': 'airtel',
            '9526': 'airtel',
            '9527': 'airtel',
            '9528': 'airtel',
            '9529': 'airtel',
            '9530': 'airtel',
            '9531': 'airtel',
            '9532': 'airtel',
            '9533': 'airtel',
            '9534': 'airtel',
            '9535': 'airtel',
            '9536': 'airtel',
            '9537': 'airtel',
            '9538': 'airtel',
            '9539': 'airtel',
            '9540': 'airtel',
            '9541': 'airtel',
            '9542': 'airtel',
            '9543': 'airtel',
            '9544': 'airtel',
            '9545': 'airtel',
            '9546': 'airtel',
            '9547': 'airtel',
            '9548': 'airtel',
            '9549': 'airtel',
            '9550': 'airtel',
            '9551': 'airtel',
            '9552': 'airtel',
            '9553': 'airtel',
            '9554': 'airtel',
            '9555': 'airtel',
            '9556': 'airtel',
            '9557': 'airtel',
            '9558': 'airtel',
            '9559': 'airtel',
            '9560': 'airtel',
            '9561': 'airtel',
            '9562': 'airtel',
            '9563': 'airtel',
            '9564': 'airtel',
            '9565': 'airtel',
            '9566': 'airtel',
            '9567': 'airtel',
            '9568': 'airtel',
            '9569': 'airtel',
            '9570': 'airtel',
            '9571': 'airtel',
            '9572': 'airtel',
            '9573': 'airtel',
            '9574': 'airtel',
            '9575': 'airtel',
            '9576': 'airtel',
            '9577': 'airtel',
            '9578': 'airtel',
            '9579': 'airtel',
            '9580': 'airtel',
            '9581': 'airtel',
            '9582': 'airtel',
            '9583': 'airtel',
            '9584': 'airtel',
            '9585': 'airtel',
            '9586': 'airtel',
            '9587': 'airtel',
            '9588': 'airtel',
            '9589': 'airtel',
            '9590': 'airtel',
            '9591': 'airtel',
            '9592': 'airtel',
            '9593': 'airtel',
            '9594': 'airtel',
            '9595': 'airtel',
            '9596': 'airtel',
            '9597': 'airtel',
            '9598': 'airtel',
            '9599': 'airtel',
            '9600': 'airtel',
            '9601': 'airtel',
            '9602': 'airtel',
            '9603': 'airtel',
            '9604': 'airtel',
            '9605': 'airtel',
            '9606': 'airtel',
            '9607': 'airtel',
            '9608': 'airtel',
            '9609': 'airtel',
            '9610': 'airtel',
            '9611': 'airtel',
            '9612': 'airtel',
            '9613': 'airtel',
            '9614': 'airtel',
            '9615': 'airtel',
            '9616': 'airtel',
            '9617': 'airtel',
            '9618': 'airtel',
            '9619': 'airtel',
            '9620': 'airtel',
            '9621': 'airtel',
            '9622': 'airtel',
            '9623': 'airtel',
            '9624': 'airtel',
            '9625': 'airtel',
            '9626': 'airtel',
            '9627': 'airtel',
            '9628': 'airtel',
            '9629': 'airtel',
            '9630': 'airtel',
            '9631': 'airtel',
            '9632': 'airtel',
            '9633': 'airtel',
            '9634': 'airtel',
            '9635': 'airtel',
            '9636': 'airtel',
            '9637': 'airtel',
            '9638': 'airtel',
            '9639': 'airtel',
            '9640': 'airtel',
            '9641': 'airtel',
            '9642': 'airtel',
            '9643': 'airtel',
            '9644': 'airtel',
            '9645': 'airtel',
            '9646': 'airtel',
            '9647': 'airtel',
            '9648': 'airtel',
            '9649': 'airtel',
            '9650': 'airtel',
            '9651': 'airtel',
            '9652': 'airtel',
            '9653': 'airtel',
            '9654': 'airtel',
            '9655': 'airtel',
            '9656': 'airtel',
            '9657': 'airtel',
            '9658': 'airtel',
            '9659': 'airtel',
            '9660': 'airtel',
            '9661': 'airtel',
            '9662': 'airtel',
            '9663': 'airtel',
            '9664': 'airtel',
            '9665': 'airtel',
            '9666': 'airtel',
            '9667': 'airtel',
            '9668': 'airtel',
            '9669': 'airtel',
            '9670': 'airtel',
            '9671': 'airtel',
            '9672': 'airtel',
            '9673': 'airtel',
            '9674': 'airtel',
            '9675': 'airtel',
            '9676': 'airtel',
            '9677': 'airtel',
            '9678': 'airtel',
            '9679': 'airtel',
            '9680': 'airtel',
            '9681': 'airtel',
            '9682': 'airtel',
            '9683': 'airtel',
            '9684': 'airtel',
            '9685': 'airtel',
            '9686': 'airtel',
            '9687': 'airtel',
            '9688': 'airtel',
            '9689': 'airtel',
            '9690': 'airtel',
            '9691': 'airtel',
            '9692': 'airtel',
            '9693': 'airtel',
            '9694': 'airtel',
            '9695': 'airtel',
            '9696': 'airtel',
            '9697': 'airtel',
            '9698': 'airtel',
            '9699': 'airtel',
            '9700': 'airtel',
            '9701': 'airtel',
            '9702': 'airtel',
            '9703': 'airtel',
            '9704': 'airtel',
            '9705': 'airtel',
            '9706': 'airtel',
            '9707': 'airtel',
            '9708': 'airtel',
            '9709': 'airtel',
            '9710': 'airtel',
            '9711': 'airtel',
            '9712': 'airtel',
            '9713': 'airtel',
            '9714': 'airtel',
            '9715': 'airtel',
            '9716': 'airtel',
            '9717': 'airtel',
            '9718': 'airtel',
            '9719': 'airtel',
            '9720': 'airtel',
            '9721': 'airtel',
            '9722': 'airtel',
            '9723': 'airtel',
            '9724': 'airtel',
            '9725': 'airtel',
            '9726': 'airtel',
            '9727': 'airtel',
            '9728': 'airtel',
            '9729': 'airtel',
            '9730': 'airtel',
            '9731': 'airtel',
            '9732': 'airtel',
            '9733': 'airtel',
            '9734': 'airtel',
            '9735': 'airtel',
            '9736': 'airtel',
            '9737': 'airtel',
            '9738': 'airtel',
            '9739': 'airtel',
            '9740': 'airtel',
            '9741': 'airtel',
            '9742': 'airtel',
            '9743': 'airtel',
            '9744': 'airtel',
            '9745': 'airtel',
            '9746': 'airtel',
            '9747': 'airtel',
            '9748': 'airtel',
            '9749': 'airtel',
            '9750': 'airtel',
            '9751': 'airtel',
            '9752': 'airtel',
            '9753': 'airtel',
            '9754': 'airtel',
            '9755': 'airtel',
            '9756': 'airtel',
            '9757': 'airtel',
            '9758': 'airtel',
            '9759': 'airtel',
            '9760': 'airtel',
            '9761': 'airtel',
            '9762': 'airtel',
            '9763': 'airtel',
            '9764': 'airtel',
            '9765': 'airtel',
            '9766': 'airtel',
            '9767': 'airtel',
            '9768': 'airtel',
            '9769': 'airtel',
            '9770': 'airtel',
            '9771': 'airtel',
            '9772': 'airtel',
            '9773': 'airtel',
            '9774': 'airtel',
            '9775': 'airtel',
            '9776': 'airtel',
            '9777': 'airtel',
            '9778': 'airtel',
            '9779': 'airtel',
            '9780': 'airtel',
            '9781': 'airtel',
            '9782': 'airtel',
            '9783': 'airtel',
            '9784': 'airtel',
            '9785': 'airtel',
            '9786': 'airtel',
            '9787': 'airtel',
            '9788': 'airtel',
            '9789': 'airtel',
            '9790': 'airtel',
            '9791': 'airtel',
            '9792': 'airtel',
            '9793': 'airtel',
            '9794': 'airtel',
            '9795': 'airtel',
            '9796': 'airtel',
            '9797': 'airtel',
            '9798': 'airtel',
            '9799': 'airtel',
            '9800': 'airtel',
            '9801': 'airtel',
            '9802': 'airtel',
            '9803': 'airtel',
            '9804': 'airtel',
            '9805': 'airtel',
            '9806': 'airtel',
            '9807': 'airtel',
            '9808': 'airtel',
            '9809': 'airtel',
            '9810': 'airtel',
            '9811': 'airtel',
            '9812': 'airtel',
            '9813': 'airtel',
            '9814': 'airtel',
            '9815': 'airtel',
            '9816': 'airtel',
            '9817': 'airtel',
            '9818': 'airtel',
            '9819': 'airtel',
            '9820': 'airtel',
            '9821': 'airtel',
            '9822': 'airtel',
            '9823': 'airtel',
            '9824': 'airtel',
            '9825': 'airtel',
            '9826': 'airtel',
            '9827': 'airtel',
            '9828': 'airtel',
            '9829': 'airtel',
            '9830': 'airtel',
            '9831': 'airtel',
            '9832': 'airtel',
            '9833': 'airtel',
            '9834': 'airtel',
            '9835': 'airtel',
            '9836': 'airtel',
            '9837': 'airtel',
            '9838': 'airtel',
            '9839': 'airtel',
            '9840': 'airtel',
            '9841': 'airtel',
            '9842': 'airtel',
            '9843': 'airtel',
            '9844': 'airtel',
            '9845': 'airtel',
            '9846': 'airtel',
            '9847': 'airtel',
            '9848': 'airtel',
            '9849': 'airtel',
            '9850': 'airtel',
            '9851': 'airtel',
            '9852': 'airtel',
            '9853': 'airtel',
            '9854': 'airtel',
            '9855': 'airtel',
            '9856': 'airtel',
            '9857': 'airtel',
            '9858': 'airtel',
            '9859': 'airtel',
            '9860': 'airtel',
            '9861': 'airtel',
            '9862': 'airtel',
            '9863': 'airtel',
            '9864': 'airtel',
            '9865': 'airtel',
            '9866': 'airtel',
            '9867': 'airtel',
            '9868': 'airtel',
            '9869': 'airtel',
            '9870': 'airtel',
            '9871': 'airtel',
            '9872': 'airtel',
            '9873': 'airtel',
            '9874': 'airtel',
            '9875': 'airtel',
            '9876': 'airtel',
            '9877': 'airtel',
            '9878': 'airtel',
            '9879': 'airtel',
            '9880': 'airtel',
            '9881': 'airtel',
            '9882': 'airtel',
            '9883': 'airtel',
            '9884': 'airtel',
            '9885': 'airtel',
            '9886': 'airtel',
            '9887': 'airtel',
            '9888': 'airtel',
            '9889': 'airtel',
            '9890': 'airtel',
            '9891': 'airtel',
            '9892': 'airtel',
            '9893': 'airtel',
            '9894': 'airtel',
            '9895': 'airtel',
            '9896': 'airtel',
            '9897': 'airtel',
            '9898': 'airtel',
            '9899': 'airtel',
            '9900': 'airtel',
            '9901': 'airtel',
            '9902': 'airtel',
            '9903': 'airtel',
            '9904': 'airtel',
            '9905': 'airtel',
            '9906': 'airtel',
            '9907': 'airtel',
            '9908': 'airtel',
            '9909': 'airtel',
            '9910': 'airtel',
            '9911': 'airtel',
            '9912': 'airtel',
            '9913': 'airtel',
            '9914': 'airtel',
            '9915': 'airtel',
            '9916': 'airtel',
            '9917': 'airtel',
            '9918': 'airtel',
            '9919': 'airtel',
            '9920': 'airtel',
            '9921': 'airtel',
            '9922': 'airtel',
            '9923': 'airtel',
            '9924': 'airtel',
            '9925': 'airtel',
            '9926': 'airtel',
            '9927': 'airtel',
            '9928': 'airtel',
            '9929': 'airtel',
            '9930': 'airtel',
            '9931': 'airtel',
            '9932': 'airtel',
            '9933': 'airtel',
            '9934': 'airtel',
            '9935': 'airtel',
            '9936': 'airtel',
            '9937': 'airtel',
            '9938': 'airtel',
            '9939': 'airtel',
            '9940': 'airtel',
            '9941': 'airtel',
            '9942': 'airtel',
            '9943': 'airtel',
            '9944': 'airtel',
            '9945': 'airtel',
            '9946': 'airtel',
            '9947': 'airtel',
            '9948': 'airtel',
            '9949': 'airtel',
            '9950': 'airtel',
            '9951': 'airtel',
            '9952': 'airtel',
            '9953': 'airtel',
            '9954': 'airtel',
            '9955': 'airtel',
            '9956': 'airtel',
            '9957': 'airtel',
            '9958': 'airtel',
            '9959': 'airtel',
            '9960': 'airtel',
            '9961': 'airtel',
            '9962': 'airtel',
            '9963': 'airtel',
            '9964': 'airtel',
            '9965': 'airtel',
            '9966': 'airtel',
            '9967': 'airtel',
            '9968': 'airtel',
            '9969': 'airtel',
            '9970': 'airtel',
            '9971': 'airtel',
            '9972': 'airtel',
            '9973': 'airtel',
            '9974': 'airtel',
            '9975': 'airtel',
            '9976': 'airtel',
            '9977': 'airtel',
            '9978': 'airtel',
            '9979': 'airtel',
            '9980': 'airtel',
            '9981': 'airtel',
            '9982': 'airtel',
            '9983': 'airtel',
            '9984': 'airtel',
            '9985': 'airtel',
            '9986': 'airtel',
            '9987': 'airtel',
            '9988': 'airtel',
            '9989': 'airtel',
            '9990': 'airtel',
            '9991': 'airtel',
            '9992': 'airtel',
            '9993': 'airtel',
            '9994': 'airtel',
            '9995': 'airtel',
            '9996': 'airtel',
            '9997': 'airtel',
            '9998': 'airtel',
            '9999': 'airtel'
        };

        const carrier = prefixMap[prefix];
        return carrier ? this.carrierGateways[carrier] : null;
    }

    /**
     * Convert phone number to email address
     * @param {string} phoneNumber - Phone number in format +91 XXXXX XXXXX
     * @returns {string|null} - Email address for SMS or null if invalid
     */
    convertToEmail(phoneNumber) {
        try {
            // Remove +91 and spaces
            const cleanNumber = phoneNumber.replace(/\+91\s/g, '');
            
            // Get carrier gateway
            const gateway = this.getCarrierGateway(phoneNumber);
            if (!gateway) {
                console.error('No carrier gateway found for number:', phoneNumber);
                return null;
            }

            // Return email address
            return `${cleanNumber}${gateway}`;
        } catch (error) {
            console.error('Error converting phone to email:', error);
            return null;
        }
    }

    /**
     * Send SMS via email-to-SMS gateway
     * @param {string} phoneNumber - Phone number in format +91 XXXXX XXXXX
     * @param {string} message - Message to send
     * @returns {Promise<boolean>} - Success status
     */
    async sendSMS(phoneNumber, message) {
        try {
            // Convert phone number to email
            const emailAddress = this.convertToEmail(phoneNumber);
            if (!emailAddress) {
                throw new Error('Invalid phone number or carrier not supported');
            }

            // Send email
            await this.transporter.sendMail({
                from: process.env.SMTP_FROM,
                to: emailAddress,
                subject: 'OTP Verification',
                text: message
            });

            return true;
        } catch (error) {
            console.error('Error sending SMS via email:', error);
            return false;
        }
    }
}

module.exports = new EmailToSmsService(); 